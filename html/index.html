<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>行政区域切换</title>
	<script type="text/javascript" src="../mapdata/china.json"></script>
	<script type="text/javascript" src="../js/echarts.js"></script>
	<!-- <script type="text/javascript" src="../js/echarts-gl.js"></script> -->
	<script type="text/javascript" src="../js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="../js/script.js"></script>
	<script type="text/javascript" src="../mapdata/cityCoordinate.json"></script>
	<style type="text/css">
		h1,h2,h3{margin:0 0;}
		h1{font-size: 30px;}
		.warp{position: relative;}
		body,html,.warp{width: 100%; height: 100%; margin: 0;}
		#main{/*width: 800px; height: 600px;*/ width: 100%; height: 100%;}
		#button{display: block; position: absolute; bottom: 0;}
		.changeColor{/*width:300px;*/ border: 1px solid #ddd; display: none; position: absolute; top: 250px; left: 250px; z-index: 999;
			background:#AFEEEE; margin:0 0 10px 10px; }
		label{display: inline-block; width: 80px; margin-left: 10px;}
		input{margin-right: 10px;}
		#styleItem{zoom:1;}
		#styleItem:after{display: block;content: ""; clear:both;}
		#styleItem div{float: left;}
		.button{margin: 10px auto; width:120px; }
		.button button{display: inline-block; width: 50px;}
		.line{display: none;}
	</style>
</head>
<body>
	<div class="warp">
		<div id="main"></div>
		<button id="button">上一级</button>
		<div class="changeColor" id="changeColor">
			<h2>设置样式</h2>

			<div id="styleItem">
			</div>
			<div class="button">
				<button id="sure">确定</button>
				<button id="cancel">取消</button>
			</div>
		</div>
	</div>
</body>
<!-- 依赖百度echarts.js -->
	<script type="text/javascript">
		//var geoData={};    //地图数据
		var chinaData=china;
		var ele=document.getElementById("main");

		var sure=document.getElementById("sure");
		var cancel=document.getElementById("cancel");
		var changeColor=document.getElementById("changeColor");
		var styleItem=document.getElementById("styleItem");
		var btn=document.getElementById("button");
		//var currentMap={};
		var count=0; //当前地图层级
		// var provinceMapData={};
		// var cityMapData={};
		var provinceClcik,cityClick;
		var option={
			backgroundColor:"#ffffff",
			center:'',
			zoom:1,
			//visualMapColor:['#50a3ba', '#eac736', '#d94e5d'],
			regionsData:regionsJsonData(chinaData),
			//regionsData:"",
			seriesData:eachGeoJson(chinaData)
		};
		var mapEchart=new mapEcharts(ele,echarts);
		//加载全国地图
		dropChinaMap();

		btn.onclick=function(){
			if(count==0){
				return;
			}
			if(count==1){
				count-=1;
				$("#main").fadeOut("100",function(){
					setTimeout(function(){
						dropChinaMap();
					},50);
					//dropChinaMap();
					$("#main").fadeIn("200");
				});
			}
			if(count==2){
				count-=1;
				$("#main").fadeOut("100",function(){
					dropProvinceMap(provinceClcik);
					$("#main").fadeIn("200");
				});
			}
		}
	//加载全国地图
	function dropChinaMap(){
		option.seriesData=eachGeoJson(chinaData);
		option.center=option.seriesData.cp;
		var chinaMap=mapEchart.DropMapGeo("china",chinaData,option,function(){
			mapEchart.linster('mouseover',function(params){
				updateMapColor(params);
				
			});
		});
		
		//mapEchart.zoomAnimation();
		var data=[
			{name: "莱芜", value: 148},
	        {name: "常德", value: 152},
	        {name: "保定", value: 153},
	        {name: "湘潭", value: 154},
	        {name: "金华", value: 157},
	        {name: "岳阳", value: 169},
	        {name: "长沙", value: 175},
	        {name: "衢州", value: 177},
	        {name: "廊坊", value: 193},
	        {name: "菏泽", value: 194},
	        {name: "合肥", value: 229},
	        {name: "武汉", value: 273},
	        {name: "大庆", value: 279}
		];
		//chinaMap.overlyHeatMap('heatMap1',convertData(geoCoordMap,data));   //绘制热力图
		//绘制贝塞尔曲线
		var bazOption={
			lineWidth:1,
			lineColor:'#ff0033',
			spotRadius:10,
			spotColor:'#ccff33'
		};
		var bezData=[
			{name:"上海",coord:[121.4648,31.2891]},
			{name:"南昌",coord:[116.0046,28.6633]},
			{name:"广州",coord:[113.5107,23.2196]},
			{name:"成都",coord:[103.9526,30.7617]}
		];
		//chinaMap.overlyBezierCurve('baz',bezData,bazOption);
		var bazData1=[
			{name:"哈尔滨",coord:[127.9688,45.368]},
			{name:"唐山",coord:[118.4766,39.6826]},
			{name:"嘉兴",coord:[120.9155,30.6354]},
			{name:"大同",coord:[113.7854,39.8035]}
		];
		///chinaMap.overlyBezierCurve('baz1',bazData1,bazOption);	
		// chinaMap.overlyImg('IMG1',[87.9236,43.5883],{   //第一张图
		// 	imgPath:'../img/home.png',
		// 	width:100,
		// 	height:100
		// });
		// chinaMap.overlyImg('IMG2',[111.4124,40.4901],{  //第二张图
		// 	imgPath:'../img/home.png',
		// 	width:50,
		// 	height:50
		// });
		//baz曲线
		// "长春": [125.8154,44.2584],
		//    "长沙": [113.0823,28.2568],
		//    "长治": [112.8625,36.4746],
		//    "阳泉": [113.4778,38.0951],
		//    "青岛": [120.4651,36.3373],
		//    "韶关": [113.7964,24.7028]
		// var baz=[
		// 	{name:"长春",coord:[125.8154,44.2584]},
		// 	{name:"呼和浩特",coord:[111.4124,40.4901]},
		// 	{name:"乌鲁木齐",coord:[87.9236,43.5883]},
		// 	{name:"成都",coord:[103.9526,30.7617]},
		// 	{name:"贵阳",coord:[106.6992,26.7682]},
		// 	{name:"长沙",coord:[113.0823,28.2568]},
		// 	// {name:"韶关",coord:[113.7964,24.7028]}
		// ];
		// chinaMap.dropBaz(baz);
		//chinaMap.setBaz();
		chinaMap.linster('click',function(params){
			count++;
			provinceClcik=params;
			$("#main").fadeOut("100",function(){
				dropProvinceMap(params);
				$("#main").fadeIn("200");
			});
			// chinaMap.zoomAnimation();
			// dropProvinceMap(params);
		});
	}
	//绘制省级地图
	function dropProvinceMap(cilckData){
		var provinceData={};
		//获取对应的地图数据
		$.getJSON('../mapdata/geometryProvince/'+cilckData.data.id+'.json',function(data){
			provinceData=data;
			option.seriesData=eachGeoJson(provinceData);
			option.regionsData=regionsJsonData(provinceData);
			option.center=option.seriesData.cp;
			option.zoom=1;
			var mapCenterCoord=getMapCoord(provinceData);    //获取地理中心数据
			var provinceMap=mapEchart.DropMapGeo("sichuan",provinceData,option,function(params){
				mapEchart.linster('mouseover',function(params){
					//if(params){}
					updateMapColor(params);
					
				});
			});
			mapEchart.zoomAnimation();
			//叠加柱状图图
			var parData=[
				{
					"regionName":"巴中市",
					"xData":["数据A","数据B","数据C"],
					"yData":[100,200,30]
				},
				{
					"regionName":"甘孜藏族自治州",
					"xData":["数据A","数据B","数据C"],
					"yData":[10,10,30]
				},
				{
					"regionName":"阿坝藏族羌族自治州",
					"xData":["数据A","数据B","数据C"],
					"yData":[10,30,30]
				}
			];
			//provinceMap.overlyBarChart(mapCenterCoord,parData);
			//叠加饼形图
			var pieData=[
				{
					regionName:"巴中市",
					data:[
						{value:335, name:'直接访问'},
		                {value:310, name:'邮件营销'},
		                {value:274, name:'联盟广告'},
		                {value:235, name:'视频广告'},
		                {value:400, name:'搜索引擎'}
					]
				},
				{
					regionName:"甘孜藏族自治州",
					data:[
						{value:335, name:'直接访问'},
		                {value:310, name:'邮件营销'},
		                {value:274, name:'联盟广告'},
		                {value:235, name:'视频广告'},
		                {value:400, name:'搜索引擎'}
					]
				}
			];
			//provinceMap.overlyPieChart(mapCenterCoord,parData);
			provinceMap.linster("click",function(params){
				if(params.componentSubType=="bar"){
					return;
				}
				count++;
				cityClick=params;
				$("#main").fadeOut("100",function(){
					dropCityMap(params);
					$("#main").fadeIn("200");
				});
				
			});
		})
	}
	//绘制市级地图
	function dropCityMap(cilckData){
		var cityData={};
		$.getJSON('../mapdata/geometryCouties/'+cilckData.data.id+'00.json',function(data){
			//cityMapData=data;
			cityData=data;
			option.seriesData=eachGeoJson(cityData);
			option.regionsData=regionsJsonData(cityData);
			option.center=option.seriesData.cp;
			option.zoom=1;
			var cityMap=mapEchart.DropMapGeo("chengdu",cityData,option,function(){
				mapEchart.linster('mouseover',function(params){
					if(params.seriesType=="lines"){
						ele.oncontextmenu=null;
					}else{
						updateMapColor(params);
					}
				});
			});
			if(cilckData.data.name=="成都市"){
				DropLine(cityMap);    //绘制线段
				dropSpot(cityMap);    //绘制点
				//mapEchart.clearAll();   //清除所有
			}
			cityMap.linster("click",function(params){
				if(params.seriesType=="lines"){      //点击线
					styleItem.innerHTML='<label>颜色：</label><input type="color" name="textColor"/><br/><label>线宽:</label><input type="text" id="width" name="width" /><br/><label>类型:</label><input type="text" id="type" name="type" /><br/><label>透明度:</label><input type="text" name="opactiy" />';
					changeColor.style.left=params.event.offsetX+"px";
					changeColor.style.top=params.event.offsetY+"px";
					changeColor.style.display="block";
					var inputs=styleItem.getElementsByTagName("input");
					sure.onclick=function(){
						var color=inputs[0].value;
						var width=inputs[1].value;
						var type=inputs[2].value;
						var opacity=inputs[3].value;
						var lineStyle={
							"color":color,
							"width":width,
							"type":type,
							"opacity":opacity
						};
						cityMap.setLineStyle(params,lineStyle);
						changeColor.style.display="none";
					};
					cancel.onclick=function(){
						changeColor.style.display="none";
					};
				}
				if(params.seriesType=="scatter"){       //点击点
					styleItem.innerHTML='<div id="textStyle"><h3>文字样式</h3><label>颜色：</label><input type="color" name="textColor"/><br/><label>大小：</label><input type="text" id="fontsize" name="fontsize" /><br/><label>偏移：</label><input type="text" id="offset" name="offset" /><br/><label>内容：</label><input type="text" name="text" /></div><div id="imgStyle"><h3>图标设置</h3><label>图形：</label><input type="text" name="symbol"/><br/><label>大小：</label><input type="number" name="symbolSize"/><br/><label>颜色：</label><input type="color" name="symbolColor"/></div>';
					//<br/><label>透明度：</label><input type="text" name="symbolOpacity"/>
					//<label>偏移：</label><input type="text" name="symbolOffset"><br/>
					changeColor.style.left=params.event.offsetX+"px";
					changeColor.style.top=params.event.offsetY+"px";
					changeColor.style.display="block";
					var oTextStyle=document.getElementById("textStyle");
					var oImgStyle=document.getElementById("imgStyle");
					var oInputText=oTextStyle.getElementsByTagName("input");
					var oInputImg=oImgStyle.getElementsByTagName("input");
					sure.onclick=function(){
						changeColor.style.display="none";
						var textColor=oInputText[0].value;
						var textSize=oInputText[1].value;
						var textOffset=oInputText[2].value;
						var text=oInputText[3].value;
						var textOption={
							"color":textColor,
							"fontSize":parseInt(textSize),
							"offset":[parseInt(textOffset.split(",")[0]),parseInt(textOffset.split(",")[1])]
						};
						cityMap.setSpotText(params,text,textOption);
						var symbolPath=oInputImg[0].value;
						var symbolSize=oInputImg[1].value;
						//var symbolOffset=oInputImg[2].value;
						var symbolColor=oInputImg[2].value;
						//var symbolOpactiy=oInputImg[4].value;
						var iocStyle={
							"symbol":symbolPath,
							"symbolSize":symbolSize,
							"color":symbolColor
						};
						cityMap.setSoptImg(params,iocStyle);
					}
					cancel.onclick=function(){
						changeColor.style.display="none";
					};

				}
				
			});

		})
	}
	//在地图上绘制线段
	function DropLine(cityMap){
		//线的json数据
		var lineJosnData=[
			[
				{"name":"郫县","coordinate":[103.88,30.82]},
				{"name":"金牛","coordinate":[104.05,30.70]},
				{"name":"成华","coordinate":[104.10,30.67]},
				{"name":"金堂","coordinate":[104.43,30.85]}
			],
			[
				{"name":"穷莱","coordinate":[103.47,30.42]},
				{"name":"新津","coordinate":[103.82,30.42]},
				{"name":"双流","coordinate":[103.92,30.58]},
				{"name":"龙泉驿","coordinate":[104.27,30.57]}
			],
			[
				{"name":"大邑","coordinate":[103.52,30.58]},
				{"name":"温江","coordinate":[103.83,30.70]},
				{"name":"新都","coordinate":[104.15,30.83]},
				{"name":"青白江","coordinate":[104.23,30.88]}
			]
		];
		 
		//线的样式
		var lineOption={         //线的配偶参数
			"color":"#fff",     //颜色,默认白色#ffffff
			"width":2,			//宽,默认宽1
			"type":"solid",		//类型 默认soild
			"opacity":0.6		//透明度 默认值0.6
		};
		//var ss;
		var lineArr=[];
		for(var i=0;i<lineJosnData.length;i++){
			var line=cityMap.setDropLines("line"+i,lineJosnData[i],lineOption);
			lineArr.push(line);
			//动画样式
			var lineAnimationOption={       //线条动画参数
				period:4,					//动画时长
				delay:0,					//动画的延时,支持数字或回调
				constantSpeed:0,    //动画的速度，设置大于0的数字后period将失效
				symbol:'circle',     //图像的标记，可以是图片途径
				color:'#fff',		 //标记的颜色
				symbolSize:12,         //标记的大小
				trailLength:0.2,      //特效尾迹的长度，取值范围（0-1）数值越大，尾迹越长
				loop:true,           //是否循环播放图画
			};
			//为线设置动画   
			//cityMap.setLineAnimation(line,lineAnimationOption,true);
			//ss=line;
			//cityMap.clearLine(ss);
		}
		//cityMap.clearLine(ss);
		cityMap.setLineAnimation(lineArr[0],{
			period:4,					//动画时长
			delay:0,					//动画的延时,支持数字或回调
			constantSpeed:0,    //动画的速度，设置大于0的数字后period将失效
			symbol:'circle',     //图像的标记，可以是图片途径
			color:'#fff',		 //标记的颜色
			symbolSize:3,         //标记的大小
			trailLength:0.2,      //特效尾迹的长度，取值范围（0-1）数值越大，尾迹越长
			loop:true,   
		},true);
		cityMap.setLineAnimation(lineArr[1],{
			period:4,					//动画时长
			delay:0,					//动画的延时,支持数字或回调
			constantSpeed:0,    //动画的速度，设置大于0的数字后period将失效
			symbol:'rect',     //图像的标记，可以是图片途径
			color:'#fff',		 //标记的颜色
			symbolSize:3,         //标记的大小
			trailLength:0.2,      //特效尾迹的长度，取值范围（0-1）数值越大，尾迹越长
			loop:true,   
		},true);
		
		var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';
		cityMap.setLineAnimation(lineArr[2],{
			period:4,					//动画时长
			delay:0,					//动画的延时,支持数字或回调
			constantSpeed:0,    //动画的速度，设置大于0的数字后period将失效
			symbol:planePath,     //图像的标记，可以是图片途径
			color:'#fff',		 //标记的颜色
			symbolSize:12,         //标记的大小
			trailLength:0,      //特效尾迹的长度，取值范围（0-1）数值越大，尾迹越长
			loop:true,   
		},true);
	}
	//在地图上绘制点
	function dropSpot(cityMap){
		//点的数据
		var spotJosnData=[
			[
				{"text":"犀浦站","coordinate":[103.88,30.82]},
				{"text":"茶店子","coordinate":[103.955063,30.767101]},
				{"text":"一品天下","coordinate":[104.07522,30.684897]},
				{"text":"崔家店","coordinate":[104.277878,30.767101]},
				{"text":"金堂站","coordinate":[104.43,30.85]}
			],
			[
				{"text":"穷莱站","coordinate":[103.47,30.42]},
				{"text":"新津站","coordinate":[103.649136,30.420487]},
				{"text":"双流站","coordinate":[103.873928,30.505157]},
				{"text":"川师大","coordinate":[104.09872,30.57483]},
				{"text":"龙泉驿站","coordinate":[104.27,30.57]}
			],
			[
				{"text":"大邑站","coordinate":[103.52,30.58]},
				{"text":"温江站","coordinate":[103.695704,30.648429]},
				{"text":"新都站","coordinate":[103.985462,30.762694]},
				{"text":"动物园","coordinate":[104.184382,30.851528]},
				{"text":"青白江站","coordinate":[104.23,30.88]}
			],
			[
				{"text":"浦江","coordinate":[103.50,30.20]}
			]
		];
		var spotOption={		//点的配置参数
			color:'#ffffff',
			// borderColor:'#ffffff',
			// borderWidth:1,
			// borderType:'solid',
			opacity:1,
			symbol:'image://../img/home.png',
			symbolSize:10,
			symbolOffset:[0,0]
		};
		var spot1;
		for(var i=0;i<spotJosnData.length;i++){
			var spots=cityMap.setDropSpot("spot"+i,spotJosnData[i],spotOption);
			//spot1=spots;
			//cityMap.clearSpot(spots);	
			if(i==spotJosnData.length-1){
				spot1=spots;
			}
		}
		cityMap.clearSpot(spot1);
	}
	//设置地图颜色
	function updateMapColor(params){
		ele.oncontextmenu =function(e){
			e=event || e;
			e.preventDefault();
			changeColor.style.left=e.clientX+"px";
			changeColor.style.top=e.clientY+"px";
			styleItem.innerHTML='<label>颜色：</label><input type="color" name="color" />';
			var oInput=styleItem.getElementsByTagName("input")[0];
			changeColor.style.display="block";
			sure.onclick=function(){
				var color=oInput.value;    //普通颜色
				// var color1={					//线性渐变
				// 	type: 'linear',
				//     x: 0,
				//     y: 0,
				//     x2: 1,
				//     y2: 1,
				//     colorStops: [{
				//         offset: 0, color: 'red' // 0% 处的颜色
				//     }, {
				//         offset: 1, color: 'blue' // 100% 处的颜色
				//     }],
				//     globalCoord: true // 缺省为 false
				// };
				// var color={           //径向渐变
				//     type: 'radial',
				//     x: 0.5,
				//     y: 0.5,
				//     r: 0.5,
				//     colorStops: [{
				//         offset: 0, color: 'red' // 0% 处的颜色
				//     }, {
				//         offset: 1, color: 'blue' // 100% 处的颜色
				//     }],
				//     globalCoord: false // 缺省为 false
				// }
				mapEchart.setMapColor(params,color);
				var textStyle={
					"fontFamily":"sans-serif",   //字体
					"fontSize":20,     //字号
					"fontWeight":"normal",   //加粗
					"fontStyle":"normal",    //斜体
					//"color":color1        //颜色
					"color":"#fff"        //颜色
				};
				mapEchart.setMapText(params,textStyle);
				changeColor.style.display="none";
			};
			cancel.onclick=function(){
				changeColor.style.display="none";
			};
		}
	}
		



	//遍历geo数据
	function eachGeoJson(geoJson){
		var data=[];
		for(var i=0;i<geoJson.features.length;++i){
			data.push({
				"id":geoJson.features[i].properties.id,
				"name":geoJson.features[i].properties.name,
				"cp":geoJson.features[i].properties.cp,
				"value":0,
				"itemStyle":{
					"color":"#00CED1"
				},
				"label":{
					"show":true,
					"color":"#ffffff",
					"fontFamily":"sans-serif",   //字体
					"fontSize":20,     //字号
					"fontWeight":"normal",   //加粗
					"fontStyle":"normal"    //斜体
				}
			}); 
		}
		return data;
	}
	function regionsJsonData(geoJson){
		var data=[];
		for(var i=0;i<geoJson.features.length;++i){
			data.push({
				"id":geoJson.features[i].properties.id,
				"name":geoJson.features[i].properties.name,
				// "cp":geoJson.features[i].properties.cp,
				// "value":0,
				"label":{
					"show":true,
					"color":"#000000",
					"fontFamily":"sans-serif",   //字体
					"fontSize":12,     //字号
					"fontWeight":"normal",   //加粗
					"fontStyle":"normal"    //斜体
				}
			}); 
		}
		return data;
	}
	function getMapCoord(geoData){
		var data={};
		for(var i=0; i<geoData.features.length;++i){
			data[geoData.features[i].properties.name]=geoData.features[i].properties.cp;
		}
		return data;
	}
	//数据转换
	function convertData(geoCoordMap,data){
		var res = [];
	    for (var i = 0; i < data.length; i++) {
	        var geoCoord = geoCoordMap[data[i].name];
	        if (geoCoord) {
	            res.push(geoCoord.concat(data[i].value));
	        }
	    }
   	 return res;
	}
	</script>


</html>

